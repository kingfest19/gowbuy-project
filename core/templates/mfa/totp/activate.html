{% extends "core/user_dashboard_base.html" %}
{% load i18n allauth crispy_forms_tags %}

{% block page_styles %}
<style>
    .mfa-step-section {
        padding: 1.5rem;
        border: 1px solid var(--bs-border-color);
        border-radius: .375rem;
        background-color: var(--bs-body-bg);
    }
    .mfa-step-section:not(:last-child) {
        margin-bottom: 2rem;
    }
    .mfa-step-section .qr-code-image {
        max-width: 250px;
        border: 1px solid var(--bs-border-color);
        padding: 10px;
        background-color: #fff; /* Ensure QR code is on a white background for scannability */
    }
</style>
{% endblock page_styles %}

{% block dashboard_content %}
    <h2 class="mb-4"><i class="fas fa-shield-alt me-2 text-muted"></i>{% trans "Activate Authenticator App" %}</h2>

    <div class="mfa-step-section">
        <h3 class="mb-3">{% trans "Step 1: Scan QR Code" %}</h3>
        <div class="text-center">
            <p>{% trans "Scan the QR code below with your authenticator app (e.g., Google Authenticator, Authy)." %}</p>
            <img src="{{ qr_code_url }}" alt="{% trans 'QR Code' %}" class="img-fluid my-3 qr-code-image">
            <p class="mt-3">
                {% trans "Can't scan the code? You can manually enter this secret key:" %}
            </p>
            <p>
                <code class="fs-5 p-2 bg-light rounded">{{ secret_key }}</code>
            </p>
        </div>
    </div>

    <div class="mfa-step-section">
        <h3 class="mb-3">{% trans "Step 2: Enter Verification Code" %}</h3>
        <p>{% trans "After scanning, enter the 6-digit code from your authenticator app to complete the setup." %}</p>
        <form method="post">
            {% csrf_token %}
            {{ form|crispy }}
            <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-lg mt-3">{% trans "Activate" %}</button>
            </div>
        </form>
    </div>
{% endblock dashboard_content %}
