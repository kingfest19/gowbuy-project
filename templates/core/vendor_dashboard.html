{% extends "base.html" %}
{% load static %}
{% load i18n humanize %} {# Added humanize for intcomma #}

{% block title %}{% trans "Vendor Dashboard" %} - {{ vendor.name }}{% endblock title %}

{% block extra_css %}
    {# Add specific dashboard CSS if needed later #}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        .dashboard-sidebar {
            background-color: #f8f9fa;
            padding: 1.5rem;
            border-radius: 0.375rem;
            height: 100%; /* Make sidebar full height within its column */
        }
        .dashboard-sidebar .nav-link {
            color: #495057;
            padding: 0.75rem 1rem;
            margin-bottom: 0.25rem;
        }
        .dashboard-sidebar .nav-link.active {
            background-color: var(--bs-primary);
            color: white;
            font-weight: 500;
        }
        .dashboard-sidebar .nav-link:hover {
            background-color: #e9ecef;
        }
        .status-badge {
            font-size: 0.9em;
        }
        .checklist-item {
            border-bottom: 1px solid #eee;
            padding: 1rem 0;
        }
        .checklist-item:last-child {
            border-bottom: none; /* Remove border from last item */
        }
        .card-text.fs-4 { /* Ensure card numbers are prominent */
            margin-bottom: 0.5rem;
        }
        .list-group-item h6 {
            margin-bottom: 0.25rem; /* Adjust spacing in lists */
        }
    </style>
{% endblock extra_css %}

{% block content %}
<div class="container-fluid my-4"> {# Use container-fluid for wider layout #}
    <div class="row">
        {# Sidebar Navigation #}
        <div class="col-md-3">
            <nav class="nav flex-column dashboard-sidebar mb-4 mb-md-0"> {# Add bottom margin for small screens #}
                <h5 class="mb-3">{% trans "Dashboard Menu" %}</h5>
                <a class="nav-link active" href="{% url 'core:vendor_dashboard' %}">üìä {% trans "Overview" %}</a>
                <a class="nav-link" href="{% url 'core:vendor_product_list' %}">üì¶ {% trans "Products" %}</a>
                <a class="nav-link" href="{% url 'core:vendor_order_list' %}">üßæ {% trans "Orders" %}</a>
                <a class="nav-link" href="{% url 'core:edit_vendor_profile' %}">‚úèÔ∏è {% trans "Edit Profile" %}</a>
                <a class="nav-link" href="{% url 'core:vendor_verification' %}">‚úÖ {% trans "Verification" %}</a>
                {# <a class="nav-link" href="#">üìà {% trans "Reports" %}</a> #} {# Link to a dedicated reports page later? #}
                <a class="nav-link" href="{% url 'core:vendor_promotion_list' %}">üè∑Ô∏è {% trans "Promotions" %}</a>
                <a class="nav-link" href="{% url 'core:vendor_campaign_list' %}">üì¢ {% trans "Ad Campaigns" %}</a>
            </nav>
        </div>

        {# Main Content Area #}
        <div class="col-md-9">
            <h1 class="mb-4">{% trans "Welcome," %} {{ vendor.name }}!</h1>

            {% include 'partials/_messages.html' %} {# Display messages at the top #}

            <!-- Start: Report Summary Section -->
            <h2 class="h4 mb-3">Store Overview</h2>
            <div class="row g-3 mb-4">
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h5 class="card-title"><i class="bi bi-currency-dollar text-success me-2"></i>Total Sales</h5>
                            <p class="card-text fs-4 fw-bold">${{ total_sales|floatformat:2|intcomma }}</p>
                            {# Note: Consider filtering sales by completed orders in the view for accuracy #}
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h5 class="card-title"><i class="bi bi-box-seam text-info me-2"></i>Total Orders</h5>
                            <p class="card-text fs-4 fw-bold">{{ total_orders_count|intcomma }}</p>
                            <small class="text-muted">Orders containing your products</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h5 class="card-title"><i class="bi bi-tags text-primary me-2"></i>Active Products</h5>
                            <p class="card-text fs-4 fw-bold">{{ active_products_count|intcomma }}</p>
                            <small class="text-muted">/ {{ total_products_count|intcomma }} total</small>
                        </div>
                    </div>
                </div>
                 <div class="col-md-6 col-lg-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h5 class="card-title"><i class="bi bi-graph-down text-warning me-2"></i>Low Stock</h5>
                            <p class="card-text fs-4 fw-bold">{{ low_stock_products.count }}</p>
                             {% if low_stock_products %}
                                <a href="#low-stock-list" class="btn btn-sm btn-outline-warning mt-1">View List</a>
                            {% else %}
                                <small class="text-muted">No items low on stock</small>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- End: Report Summary Section -->

            {# --- START: Onboarding Checklist --- #}
            <div class="mb-4 p-3 border rounded bg-light"> {# Added padding, border, background #}
                <h5 class="mb-3">{% trans "Shop Setup Checklist" %}</h5>
                {% if not all_sections_complete and not vendor.is_approved %}
                    <div class="alert alert-warning small p-2 mb-3"> {# Adjusted padding/margin #}
                        {% trans "Please complete all required sections below to activate your shop." %}
                    </div>
                {% elif all_sections_complete and not vendor.is_approved %}
                    <div class="alert alert-info small p-2 mb-3">
                        {% trans "All sections complete! Your shop is pending final review by our team." %}
                    </div>
                {% elif vendor.is_approved %}
                     <div class="alert alert-success small p-2 mb-3">
                        {% trans "Your shop is live!" %}
                    </div>
                {% endif %}

                <div class="checklist-item d-flex justify-content-between align-items-center">
                    <span><a href="{% url 'core:edit_vendor_profile' %}">{% trans "Shop Information" %}</a></span>
                    <span class="badge status-badge {% if shop_info_complete %}bg-success{% else %}bg-warning text-dark{% endif %}">{% if shop_info_complete %}{% trans "COMPLETED" %}{% else %}{% trans "PENDING" %}{% endif %}</span>
                </div>
                <div class="checklist-item d-flex justify-content-between align-items-center">
                    <span><a href="{% url 'core:vendor_verification' %}">{% trans "Business/Verification Information" %}</a></span>
                    <span class="badge status-badge {% if business_info_status == 'COMPLETED' %}bg-success{% elif business_info_status == 'PENDING REVIEW' %}bg-info text-dark{% else %}bg-warning text-dark{% endif %}">{% trans business_info_status %}</span>
                </div>
                <div class="checklist-item d-flex justify-content-between align-items-center">
                    <span><a href="{% url 'core:edit_vendor_shipping' %}">{% trans "Shipping Information" %}</a></span>
                    <span class="badge status-badge {% if shipping_info_complete %}bg-success{% else %}bg-warning text-dark{% endif %}">{% if shipping_info_complete %}{% trans "COMPLETED" %}{% else %}{% trans "PENDING" %}{% endif %}</span>
                </div>
                <div class="checklist-item d-flex justify-content-between align-items-center">
                    <span><a href="{% url 'core:edit_vendor_payment' %}">{% trans "Payment Information" %}</a></span>
                    <span class="badge status-badge {% if payment_info_complete %}bg-success{% else %}bg-warning text-dark{% endif %}">{% if payment_info_complete %}{% trans "COMPLETED" %}{% else %}{% trans "PENDING" %}{% endif %}</span>
                </div>
                <div class="checklist-item d-flex justify-content-between align-items-center">
                    <span><a href="#">{% trans "Additional Information" %}</a></span> {# TODO: Add URL for additional info view #}
                    <span class="badge status-badge {% if additional_info_complete %}bg-success{% else %}bg-warning text-dark{% endif %}">{% if additional_info_complete %}{% trans "COMPLETED" %}{% else %}{% trans "PENDING" %}{% endif %}</span>
                </div>
            </div>
            {# --- END: Onboarding Checklist --- #}

            <!-- Start: Recent Orders and Low Stock Lists -->
            <div class="row g-4 mt-4">
                <!-- Recent Orders -->
                <div class="col-lg-7">
                    <h2 class="h4 mb-3"><i class="bi bi-receipt me-2"></i>Recent Orders</h2>
                    {% if recent_orders %}
                    <div class="list-group">
                        {% for order in recent_orders %}
                        {# Link to the standard order detail for now, consider a vendor-specific one later #}
                        <a href="{% url 'core:order_detail' order.order_id %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Order #{{ order.order_id }}</h6>
                                <small class="text-muted">Placed on: {{ order.created_at|date:"M d, Y H:i" }}</small>
                                {% if order.user %}<small class="d-block">Customer: {{ order.user.username }}</small>{% endif %}
                            </div>
                            {# Dynamically set badge color based on status text #}
                            <span class="badge bg-{% if order.status == 'pending' %}warning text-dark{% elif order.status == 'processing' %}info text-dark{% elif order.status == 'shipped' %}primary{% elif order.status == 'delivered' %}success{% elif order.status == 'cancelled' or order.status == 'refunded' %}danger{% else %}secondary{% endif %} rounded-pill">{{ order.get_status_display }}</span>
                        </a>
                        {% endfor %}
                    </div>
                    <div class="mt-2">
                         {# Ensure you have a 'vendor_order_list' URL pattern defined #}
                         <a href="{% url 'core:vendor_order_list' %}" class="btn btn-sm btn-outline-secondary">View All Orders</a>
                    </div>
                    {% else %}
                    <div class="alert alert-light" role="alert">
                        No recent orders found.
                    </div>
                    {% endif %}
                </div>

                <!-- Low Stock Products -->
                <div class="col-lg-5" id="low-stock-list">
                    <h2 class="h4 mb-3"><i class="bi bi-box-fill text-danger me-2"></i>Low Stock Items (<= 5)</h2>
                    {% if low_stock_products %}
                    <div class="list-group">
                        {% for product in low_stock_products %}
                        <a href="{% url 'core:vendor_product_edit' product.id %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">{{ product.name }}</h6>
                                <small class="text-muted">SKU: {{ product.sku|default:"N/A" }}</small> {# Assuming you might add an SKU field later #}
                            </div>
                            <span class="badge bg-danger rounded-pill">{{ product.stock }} left</span>
                        </a>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="alert alert-light" role="alert">
                        No products are currently low on stock.
                    </div>
                    {% endif %}
                </div>
            </div>
            <!-- End: Recent Orders and Low Stock Lists -->

        </div>
    </div>
</div>
{% endblock content %}

{% block extra_js %}
    {{ block.super }}
    {# Add specific dashboard JS if needed #}
{% endblock extra_js %}
