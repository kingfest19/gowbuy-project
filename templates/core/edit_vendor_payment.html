{% extends "base.html" %}
{% load static i18n crispy_forms_tags %}

{% block title %}{% trans "Edit Payment Information" %} - {{ vendor.name }}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        .form-container {
            max-width: 900px; /* Good width for forms */
            margin: 0 auto;
            background-color:  #ebe8e8;
            padding: 2rem 2.5rem;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07);
            border: 1px solid #c7c9cb;
            font-family: "Outfit", sans-serif; /* Consistent font from theme */
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #f0f2f5;
        }

        .page-header h1 {
            font-family: "Poppins", sans-serif; /* Consistent font from theme */
            font-weight: 700;
            color: #1a2533;
            margin-bottom: 0;
        }

        fieldset {
            background-color: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        fieldset:last-of-type {
            margin-bottom: 0;
        }

        legend {
            font-family: "Poppins", sans-serif; /* Consistent font from theme */
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a2533;
            padding: 0;
            width: 100%;
            float: left;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #e9ecef;
        }

        .form-container .form-control,
        .form-container .form-select {
            border: 1px solid #ced4da;
            transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
        }
        .form-container .form-control:focus,
        .form-container .form-select:focus {
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }

        .form-label {
            font-weight: 500;
            color: #495057;
            font-size: 0.9rem;
        }

        .form-container .btn-primary {
            background-color: #474747;
            border-color: #474747;
            font-weight: 500;
        }
        .form-container .btn-primary:hover {
            background-color: #383838;
            border-color: #383838;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .form-container .btn-outline-secondary {
            background-color: #474747;
            color: #ffffffff;
            border-color: #474747;
        }
        .btn-outline-secondary:hover {
            background-color: #474747;
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
    </style>
{% endblock extra_css %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="form-container">
        <div class="page-header">
            <div>
                <h1>{% trans "Payout Settings" %}</h1>
                <p class="text-muted mb-0">{% trans "Update your payout details for" %} {{ vendor.name }}</p>
            </div>
            <a href="{% url 'core:vendor_dashboard' %}" class="btn btn-lg btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>{% trans "Back to Dashboard" %}
            </a>
        </div>

        <form method="post">
            {% csrf_token %}

            {% include 'partials/_messages.html' %}

            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors|join:", " }}
                </div>
            {% endif %}

            <div class="form-body">
                <p class="text-muted mb-4">{% trans "Manage how you receive payments for your sales. Please ensure your details are correct to avoid payout delays. You only need to fill in the methods you wish to use." %}</p>

                <fieldset>
                    <legend>{% trans "Mobile Money Details" %}</legend>
                    <div class="row">
                        <div class="col-md-6">
                            {{ form.mobile_money_provider|as_crispy_field }}
                        </div>
                        <div class="col-md-6">
                            {{ form.mobile_money_number|as_crispy_field }}
                        </div>
                    </div>
                    <div class="text-end mt-2">
                        <button type="button" class="btn btn-sm btn-link text-danger clear-fieldset-btn">
                            <i class="bi bi-x-circle"></i> {% trans "Clear Mobile Money Details" %}
                        </button>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>{% trans "Bank Account Details" %}</legend>
                    {{ form.bank_account_name|as_crispy_field }}
                    <div class="row">
                        <div class="col-md-6">
                            {{ form.bank_account_number|as_crispy_field }}
                        </div>
                        <div class="col-md-6">
                            {{ form.bank_name|as_crispy_field }}
                        </div>
                    </div>
                    {{ form.bank_branch|as_crispy_field }}
                    <div class="text-end mt-2">
                        <button type="button" class="btn btn-sm btn-link text-danger clear-fieldset-btn">
                            <i class="bi bi-x-circle"></i> {% trans "Clear Bank Account Details" %}
                        </button>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>{% trans "International & Online Gateways" %}</legend>
                    {{ form.paypal_email|as_crispy_field }}
                    {{ form.stripe_account_id|as_crispy_field }}
                    <div class="row">
                        <div class="col-md-6">
                            {{ form.payoneer_email|as_crispy_field }}
                        </div>
                        <div class="col-md-6">
                            {{ form.wise_email|as_crispy_field }}
                        </div>
                    </div>
                    <div class="text-end mt-2">
                        <button type="button" class="btn btn-sm btn-link text-danger clear-fieldset-btn">
                            <i class="bi bi-x-circle"></i> {% trans "Clear International Gateway Details" %}
                        </button>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>{% trans "Cryptocurrency" %}</legend>
                    {{ form.crypto_wallet_address|as_crispy_field }}
                    {{ form.crypto_wallet_network|as_crispy_field }}
                    <div class="text-end mt-2">
                        <button type="button" class="btn btn-sm btn-link text-danger clear-fieldset-btn">
                            <i class="bi bi-x-circle"></i> {% trans "Clear Cryptocurrency Details" %}
                        </button>
                    </div>
                </fieldset>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                    <a href="{% url 'core:vendor_dashboard' %}" class="btn btn-outline-secondary">{% trans "Cancel" %}</a>
                    <button type="submit" class="btn btn-primary">{% trans "Save Payout Settings" %}</button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.clear-fieldset-btn').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            if (confirm("{% trans 'Are you sure you want to clear these details? The information will be removed when you save.' %}")) {
                const fieldset = this.closest('fieldset');
                fieldset.querySelectorAll('input, select').forEach(input => {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = false;
                    } else if (input.type !== 'hidden') { // Don't clear hidden inputs like csrf
                        input.value = '';
                    }
                });
                // For select elements, reset to the first option (usually a placeholder)
                fieldset.querySelectorAll('select').forEach(select => {
                    select.selectedIndex = 0;
                    select.dispatchEvent(new Event('change'));
                });
            }
        });
    });
});
</script>
{% endblock extra_js %}