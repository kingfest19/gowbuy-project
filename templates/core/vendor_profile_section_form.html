{% extends "base.html" %}
{% load static i18n crispy_forms_tags %}

{% block title %}{{ page_title|default:_("Update Vendor Section") }} - {{ block.super }}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        .form-container {
            max-width: 900px; /* Adjusted for a form layout */
            margin: 0 auto;
            background-color: #fff;
            padding: 2rem 2.5rem;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07);
            border: 1px solid #000000ff;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 1.5rem;
            margin-bottom: 2.5rem;
            border-radius: 8px;
            background-color: #fff3e0; /* Lighter orange background */
            border-left: 5px solid #ff9800; /* Prominent orange left border */
            border: 1px solid #000000ff; /* Subtle border for separation */
        }

        .page-header h1 {
            font-weight: 600;
            color: #e65100; /* Darker orange text for contrast */
            margin-bottom: 0;
        }

        /* --- Form Field Styling --- */
        .form-label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 0.5rem;
        }

        .form-control,
        .form-select {
            border-radius: 8px;
            border: 1.5px solid #dee2e6;
            padding: 0.75rem 1rem;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            background-color: #f8f9fa; /* A very light grey background */
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #ff9800; /* Match the orange theme */
            box-shadow: 0 0 0 0.2rem rgba(255, 152, 0, 0.2);
            background-color: #fff;
        }

        .form-text { /* For Crispy Forms help text */
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }

        .form-check-input:checked {
            background-color: #e65100; /* Darker orange for checked state */
            border-color: #e65100;
        }
    </style>
{% endblock extra_css %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="form-container">
        <div class="page-header">
            <div>
                <h1>{{ form_title|default:_("Update Information") }}</h1>
                <p class="text-muted mb-0">{% trans "Update your vendor profile details below." %}</p>
            </div>
            <a href="{% url 'core:vendor_dashboard' %}" class="btn btn-lg btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>{% trans "Back to Dashboard" %}
            </a>
        </div>

        {% include 'partials/_messages.html' %}

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form|crispy }}
            <div class="d-grid mt-4">
                <button type="submit" class="btn btn-success btn-lg">{% trans "Save Changes" %}</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    {% if form.fields.verification_method %} {# Only add this JS if the verification_method field is on the form #}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const verificationMethodRadios = document.querySelectorAll('input[name="verification_method"]');

        // Define the specific fields (by their Crispy Forms div IDs) for each method
        // Ensure these IDs match what Crispy Forms generates (e.g., div_id_your_field_name)
        const businessSpecificFields = [
            'div_id_business_registration_document',
            'div_id_tax_id_number',
            'div_id_other_supporting_document'
        ];
        const individualSpecificFields = [
            'div_id_national_id_type',
            'div_id_national_id_number',
            'div_id_national_id_document'
        ];

        function toggleVerificationFields() {
            let selectedMethod = '';
            verificationMethodRadios.forEach(radio => {
                if (radio.checked) {
                    selectedMethod = radio.value;
                }
            });

            if (selectedMethod === '{{ Vendor.VERIFICATION_METHOD_BUSINESS }}') {
                businessSpecificFields.forEach(id => { const el = document.getElementById(id); if (el) el.style.display = ''; });
                individualSpecificFields.forEach(id => { const el = document.getElementById(id); if (el) el.style.display = 'none'; });
            } else if (selectedMethod === '{{ Vendor.VERIFICATION_METHOD_INDIVIDUAL }}') {
                businessSpecificFields.forEach(id => { const el = document.getElementById(id); if (el) el.style.display = 'none'; });
                individualSpecificFields.forEach(id => { const el = document.getElementById(id); if (el) el.style.display = ''; });
            } else {
                // If no method is selected (e.g., on initial load and no pre-selection), hide both
                businessSpecificFields.forEach(id => { const el = document.getElementById(id); if (el) el.style.display = 'none'; });
                individualSpecificFields.forEach(id => { const el = document.getElementById(id); if (el) el.style.display = 'none'; });
            }
        }

        verificationMethodRadios.forEach(radio => {
            radio.addEventListener('change', toggleVerificationFields);
        });

        // Initial call to set the correct fields visibility on page load.
        // This will respect any initial value set for the radio buttons.
        toggleVerificationFields();
    });
    </script>
    {% endif %}
    {# Your existing map script can go here if needed for other forms using this template #}
    {% if 'street_address' in form.fields and 'location_city' in form.fields and 'location_country' in form.fields and google_maps_api_key %}
        {# <script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&libraries=places&callback=initMap" async defer></script> #}
        {# <script> // Map initialization script was here </script> #}
    {% endif %} {% block extra_js_after_verification %}{% endblock %}
{% endblock extra_js %}
