{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Manage Products" %} - {{ vendor.name }}{% endblock %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>{% trans "Manage Products" %}</h1>
        <a href="{% url 'core:vendor_product_create' %}" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i> {% trans "Add New Product" %}
        </a>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}

    {# Display filter status #}
    {% if is_filtered and stock_status_filter == 'low' %}
        <div class="alert alert-info d-flex justify-content-between align-items-center">
            <span>Showing only low stock items (<= 5).</span>
            <a href="{% url 'core:vendor_product_list' %}" class="btn btn-sm btn-outline-secondary">Clear Filter</a>
        </div>
    {% endif %}

    {% if products %}
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead>
                <tr>
                    {# <th>{% trans "Image" %}</th> #} {# TODO: Add image display #}
                    <th>{% trans "Name" %}</th>
                    <th>{% trans "Category" %}</th>
                    <th>{% trans "Price" %}</th>
                    <th>{% trans "Stock" %}</th>
                    <th>{% trans "Active" %}</th>
                    <th>{% trans "Featured" %}</th>
                    <th>{% trans "Actions" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    {# <td><img src="{{ product.image.url }}" alt="{{ product.name }}" height="50"></td> #} {# TODO: Use primary image from gallery #}
                    <td>{{ product.name }}</td>
                    <td>{{ product.category.name }}</td>
                    <td>${{ product.price|floatformat:2 }}</td>
                    <td>{{ product.stock }}</td>
                    <td>{% if product.is_active %}<i class="bi bi-check-circle-fill text-success"></i>{% else %}<i class="bi bi-x-circle-fill text-danger"></i>{% endif %}</td>
                    <td>{% if product.is_featured %}<i class="bi bi-star-fill text-warning"></i>{% else %}<i class="bi bi-star text-muted"></i>{% endif %}</td>
                    <td>
                        <a href="{% url 'core:vendor_product_edit' product.id %}" class="btn btn-sm btn-outline-secondary me-1">{% trans "Edit" %}</a>
                        <form action="{% url 'core:vendor_product_delete' product.id %}" method="post" class="d-inline" onsubmit="return confirm('Are you sure you want to delete \'{{ product.name|escapejs }}\'?');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger">{% trans "Delete" %}</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info">{% trans "You haven't added any products yet." %}</div>
    {% endif %}
    <a href="{% url 'core:vendor_dashboard' %}" class="btn btn-link mt-3">{% trans "Back to Dashboard" %}</a>
</div>
{% endblock %}