 {% extends "base.html" %}
 {% load static i18n humanize query_params %}
 
 {% block title %}{% trans "Manage Bookings" %}{% endblock title %}
 
 {% block extra_css %}
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
     <style>
         .list-container {
             max-width: 1200px;
             margin: 0 auto;
             background-color: #ebe8e8;
             padding: 2rem 2.5rem;
             border-radius: 12px;
             box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07);
             border: 1px solid #959aa0; /* Softer border */
         }
 
         .page-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             flex-wrap: wrap;
             gap: 1rem;
             padding: 1.5rem;
             margin-bottom: 2.5rem;
             border-radius: 8px;
             background-color: #ffffff; /* White background */
             border-left: 5px solid #323232ff; /* Prominent black left border */
             border: 1px solid #c7c9cb; /* Subtle border for separation */
         }
 
         .page-header h1 {
             font-weight: 600;
             color: #323232ff; /* Black text for contrast */
             margin-bottom: 0;
         }
 
         .table {
             border-collapse: separate;
             border-spacing: 0 0.75rem; /* Increased spacing for a "card list" feel */
         }
 
         .table thead th {
             border: none;
             font-weight: 600;
             color: #6c757d;
             background-color: transparent; /* Make header transparent to show page bg */
             padding: 0.5rem 1rem;
             text-transform: uppercase;
             font-size: 0.8rem;
             letter-spacing: 0.5px;
         }
 
         .table tbody tr {
             background-color: #fff;
             border-radius: 8px;
             box-shadow: 0 2px 8px rgba(0,0,0,0.06);
             transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
             border: 1px solid #f0f2f5;
         }
         
         .table tbody tr:hover {
             transform: translateY(-3px);
             box-shadow: 0 5px 15px rgba(0,0,0,0.1);
         }
 
         .table td, .table th {
             border: none;
             vertical-align: middle;
             padding: 1rem;
         }
 
         .filter-bar {
             background-color: #f8f9fa;
             padding: 1rem;
             border-radius: 8px;
             margin-bottom: 2rem;
             border: 1px solid #c7c9cb; /* Softer border */
         }
 
         .btn-dark {
             background-color: #474747;
             border-color: #474747;
         }
         .btn-dark:hover {
             background-color: #383838; /* A darker shade for hover */
             border-color: #383838;
         }
 
         .page-header .btn-outline-secondary {
             background-color: #474747;
             color: #ffffff;
             border-color: #474747;
         }
         .page-header .btn-outline-secondary:hover {
             background-color: #383838;
             border-color: #383838;
         }
     </style>
 {% endblock extra_css %}
 
 {% block content %}
 <div class="container mt-5 mb-5">
     <div class="list-container">
         <div class="page-header">
             <div>
                 <h1>{% trans "Manage Bookings" %}</h1>
                 <p class="text-muted mb-0">{% trans "View and manage all your service bookings." %}</p>
             </div>
             <a href="{% url 'core:service_provider_dashboard' %}" class="btn btn-lg btn-outline-secondary">
                 <i class="bi bi-arrow-left me-2"></i>{% trans "Back to Dashboard" %}
             </a>
         </div>
 
         {% include 'partials/_messages.html' %}
 
         <!-- Filter Bar -->
         <div class="filter-bar">
             <form method="get" action="">
                 <div class="row g-2 align-items-center">
                     <div class="col-md">
                         <div class="input-group">
                             <input type="text" name="q" class="form-control" placeholder="{% trans 'Search by customer or service...' %}" value="{{ search_query|default:'' }}">
                             <button class="btn btn-outline-secondary" type="submit"><i class="bi bi-search"></i></button>
                         </div>
                     </div>
                     <div class="col-md-auto">
                         <div class="btn-group" role="group" aria-label="Booking status filter">
                             <a href="?{% query_transform status='' page=1 %}" class="btn {% if not current_status %}btn-dark{% else %}btn-outline-secondary{% endif %}">{% trans "All" %}</a>
                             <a href="?{% query_transform status='upcoming' page=1 %}" class="btn {% if current_status == 'upcoming' %}btn-dark{% else %}btn-outline-secondary{% endif %}">{% trans "Upcoming" %}</a>
                             <a href="?{% query_transform status='completed' page=1 %}" class="btn {% if current_status == 'completed' %}btn-dark{% else %}btn-outline-secondary{% endif %}">{% trans "Completed" %}</a>
                             <a href="?{% query_transform status='cancelled' page=1 %}" class="btn {% if current_status == 'cancelled' %}btn-dark{% else %}btn-outline-secondary{% endif %}">{% trans "Cancelled" %}</a>
                         </div>
                     </div>
                 </div>
             </form>
         </div>
 
         <div class="table-responsive">
             <table class="table table-hover table-vcenter mb-0">
                 <thead>
                     <tr>
                         <th>{% trans "Booking ID" %}</th>
                         <th>{% trans "Customer" %}</th>
                         <th>{% trans "Service & Package" %}</th>
                         <th>{% trans "Date & Time" %}</th>
                         <th class="text-center">{% trans "Status" %}</th>
                         <th class="text-end">{% trans "Total" %}</th>
                         <th class="text-end pe-3">{% trans "Actions" %}</th>
                     </tr>
                 </thead>
                 <tbody>
                     {% for booking in bookings %}
                     <tr>
                         <td><a href="{% url 'core:service_provider_booking_detail' booking.id %}" class="fw-bold text-decoration-none text-dark">#{{ booking.id }}</a></td>
                         <td>{{ booking.user.get_full_name|default:booking.user.username }}</td>
                         <td>
                             <span class="d-block">{{ booking.service_package.service.title }}</span>
                             <small class="text-muted">{{ booking.service_package.name }}</small>
                         </td>
                         <td>
                             {% if booking.availability_slot %}
                                 <span class="d-block">{{ booking.availability_slot.start_time|date:"M d, Y" }}</span>
                                 <small class="text-muted">{{ booking.availability_slot.start_time|time:"H:i" }} - {{ booking.availability_slot.end_time|time:"H:i" }}</small>
                             {% else %}
                                 <span class="text-muted">{% trans "To be coordinated" %}</span>
                             {% endif %}
                         </td>
                         <td class="text-center">
                             <span class="badge rounded-pill
                                 {% if booking.status == 'completed' %}bg-success
                                 {% elif booking.status == 'cancelled' %}bg-danger
                                 {% elif booking.status == 'confirmed' %}bg-primary
                                 {% else %}bg-warning text-dark{% endif %}">
                                 {{ booking.get_status_display }}
                             </span>
                         </td>
                         <td class="text-end">{{ settings.DEFAULT_CURRENCY_SYMBOL|default:"GHâ‚µ" }}{{ booking.service_package.price|floatformat:2|intcomma }}</td>
                         <td class="text-end">
                             <a href="{% url 'core:service_provider_booking_detail' booking.id %}" class="btn btn-sm btn-outline-dark">{% trans "View Details" %}</a>
                         </td>
                     </tr>
                     {% empty %}
                     <tr>
                         <td colspan="7" class="text-center py-5">
                             <i class="bi bi-calendar-x" style="font-size: 3rem; color: #6c757d;"></i>
                             <h4 class="mt-3">{% trans "No Bookings Found" %}</h4>
                             {% if search_query or current_status %}
                                 <p class="text-muted">{% trans "Try adjusting your search or filter to find what you're looking for." %}</p>
                                 <a href="{% url 'core:service_provider_bookings_list' %}" class="btn btn-secondary btn-sm">{% trans "Clear Filters" %}</a>
                             {% else %}
                                 <p class="text-muted">{% trans "You do not have any bookings at the moment." %}</p>
                             {% endif %}
                         </td>
                     </tr>
                     {% endfor %}
                 </tbody>
             </table>
         </div>
 
         {% if is_paginated %}
         <div class="mt-4">
             {% include "core/snippets/pagination_snippet.html" with page_obj=page_obj %}
         </div>
         {% endif %}
     </div>
 </div>
 {% endblock content %}