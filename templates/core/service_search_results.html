{% extends "base.html" %}
{% load static i18n humanize %}

{% block title %}{{ page_title }}{% endblock title %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'assets/css/service_marketplace.css' %}">
    {# Re-use the same flat item styling from service_list.html #}
    <style>
        .service-item-flat {
            padding: 1.25rem;
            border: 1px solid #e0e0e0;
            border-radius: 0.375rem;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: box-shadow 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .service-item-flat:hover {
            transform: translateY(-3px);
            box-shadow: 0 0.3rem 0.8rem rgba(0,0,0,0.1);
        }
        .service-item-flat img {
            height: 180px;
            width: 100%;
            object-fit: cover;
            border-radius: 0.25rem;
            margin-bottom: 0.75rem;
        }
        .service-item-flat h5 a { color: #333; font-weight: 600; }
        .service-item-flat h5 a:hover { color: var(--bs-primary); }
        .service-item-flat .provider-info { font-size: 0.85rem; color: #6c757d; }
        .service-item-flat .service-description-flat { font-size: 0.9rem; color: #495057; flex-grow: 1; }
        .service-item-flat .service-price-flat { font-weight: bold; color: var(--bs-success); }
        .service-item-flat .btn-details-flat { margin-top: auto; }
    </style>
{% endblock extra_css %}

{% block content %}
<div class="container my-4">
    <div class="row mb-4">
        <div class="col-md-8 offset-md-2">
            <h1 class="text-center mb-3">{{ page_title }}</h1>
            {# Search Bar - can reuse your existing search form logic, pointing to this page #}
            <form method="get" action="{% url 'core:service_search_results' %}" class="mb-4">
                <div class="input-group input-group-lg">
                    <input type="text" name="q" class="form-control" placeholder="{% trans 'Search for services...' %}" value="{{ search_query|default:'' }}">
                    <button class="btn btn-primary" type="submit"><i class="fas fa-search"></i> {% trans "Search" %}</button>
                </div>
            </form>
        </div>
    </div>

    {% if services %}
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
            {% for service in services %}
            <div class="col">
                <div class="service-item-flat">
                    <a href="{{ service.get_absolute_url }}">
                        {% if service.images.first.image.url %}
                            <img src="{{ service.images.first.image.url }}" alt="{{ service.title }}">
                        {% else %}
                            <img src="{% static 'assets/img/placeholder.png' %}" alt="{% trans 'Placeholder' %}">
                        {% endif %}
                    </a>
                    <h5 class="mb-1">
                        <a href="{{ service.get_absolute_url }}" class="text-decoration-none stretched-link">{{ service.title|truncatechars:50 }}</a>
                    </h5>
                    <p class="provider-info mb-2">
                        <i class="bi bi-person-fill"></i> {{ service.provider.username }}
                        {% if service.provider.service_provider_profile and service.provider.service_provider_profile.is_approved %}
                            <i class="bi bi-patch-check-fill text-success ms-1" title="{% trans 'Verified Provider' %}"></i>
                        {% endif %}
                    </p>
                    <p class="service-description-flat mb-2">{{ service.description|truncatewords_html:12 }}</p>
                    {% if service.packages.exists %}
                        <p class="service-price-flat mb-2">
                            {% trans "From" %}: GHâ‚µ {{ service.packages.all.first.price|floatformat:2|intcomma }}
                        </p>
                    {% endif %}
                    <a href="{{ service.get_absolute_url }}" class="btn btn-sm btn-outline-primary w-100 btn-details-flat">{% trans "View Details" %}</a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% include "core/includes/pagination.html" %} {# Assuming page_obj is 'services' or passed correctly #}
    {% elif search_query %}
        <p class="lead text-center">{% trans "No services found matching your search for" %} '{{ search_query }}'.</p>
    {% else %}
        <p class="lead text-center">{% trans "Please enter a search term to find services." %}</p>
    {% endif %}
</div>
{% endblock content %}